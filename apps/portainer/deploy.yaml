apiVersion: apps/v1
kind: Deployment
metadata:
  name: portainer
  namespace: portainer
  labels: { app: portainer }
spec:
  replicas: 1
  selector: { matchLabels: { app: portainer } }
  template:
    metadata: { labels: { app: portainer } }
    spec:
      serviceAccountName: portainer-sa
      containers:
        - name: portainer
          image: portainer/portainer-ce:latest
          imagePullPolicy: IfNotPresent
          args: ["--tunnel-port=8000"]
          ports:
            - { name: http,  containerPort: 9000 }
            - { name: https, containerPort: 9443 }
          volumeMounts:
            - { name: data, mountPath: /data }
          readinessProbe:
            httpGet: { path: /, port: 9000 }
            initialDelaySeconds: 10
          livenessProbe:
            httpGet: { path: /, port: 9000 }
            initialDelaySeconds: 20
      volumes:
        - name: data
          persistentVolumeClaim:
            claimName: portainer-data
