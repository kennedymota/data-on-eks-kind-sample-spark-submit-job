apiVersion: batch/v1
kind: Job
metadata:
  generateName: spark-pi-standalone-
  namespace: spark
spec:
  backoffLimit: 0
  template:
    spec:
      restartPolicy: Never
      containers:
        - name: submit
          image: apache/spark:3.5.1
          command: ["/opt/spark/bin/spark-submit"]
          args:
            - --master
            - spark://spark-master-svc:7077
            - --deploy-mode
            - cluster
            - --class
            - org.apache.spark.examples.SparkPi
            - --conf
            - spark.executor.instances=2
            - --conf
            - spark.executor.cores=1
            - --conf
            - spark.executor.memory=512m
            - --conf
            - spark.driver.cores=1
            - --conf
            - spark.driver.memory=512m
            # opcional: logs de histórico se tiver armazenamento compartilhado (ex.: S3/PVC)
            # - --conf
            # - spark.eventLog.enabled=true
            # - --conf
            # - spark.eventLog.dir=s3a://<bucket>/spark-events
            - /opt/spark/examples/jars/spark-examples_2.12-3.5.1.jar
            - "1000"
          # limites só para o POD do submit (não afeta executores no Standalone)
          resources:
            requests:
              cpu: "200m"
              memory: "256Mi"
            limits:
              cpu: "500m"
              memory: "512Mi"
